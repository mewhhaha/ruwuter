// Generated from src/runtime/client.ts using
//   base64 -w0 src/runtime/client.ts
// Update alongside runtime changes to keep DOM tests in sync.

const CLIENT_RUNTIME_BASE64 =
  "dHlwZSBSZWZMaXN0ZW5lciA9ICgpID0+IHZvaWQ7Cgp0eXBlIEV2ZW50TGlzdGVuZXJPcHRpb25zID0gewogIGNhcHR1cmU/OiBib29sZWFuOwogIG9uY2U/OiBib29sZWFuOwogIHBhc3NpdmU/OiBib29sZWFuOwogIHByZXZlbnREZWZhdWx0PzogYm9vbGVhbjsKfTsKCnR5cGUgTW9kdWxlRW50cnkgPSB7CiAgdDogIm0iOwogIHM6IHN0cmluZzsKICB4Pzogc3RyaW5nOwogIGV2Pzogc3RyaW5nOwogIG9wdD86IEV2ZW50TGlzdGVuZXJPcHRpb25zOwp9OwoKdHlwZSBIeWRyYXRpb25QYXlsb2FkID0gewogIGJpbmQ/OiB1bmtub3duOwogIG9uPzogTW9kdWxlRW50cnlbXTsKfTsKCnR5cGUgQ2xpZW50Rm4gPSAodGhpczogdW5rbm93biwgZXY6IEV2ZW50LCBzaWduYWw6IEFib3J0U2lnbmFsKSA9PiB1bmtub3duOwoKaW50ZXJmYWNlIFJlZk9iamVjdCB7CiAgaWQ6IHN0cmluZzsKICBnZXQoKTogdW5rbm93bjsKICBzZXQobmV4dDogdW5rbm93biB8ICgocHJldjogdW5rbm93bikgPT4gdW5rbm93bikpOiB2b2lkOwogIHRvSlNPTigpOiB7IF9fcmVmOiB0cnVlOyBpOiBzdHJpbmc7IHY6IHVua25vd24gfTsKICB0b1N0cmluZygpOiBzdHJpbmc7Cn0KCmludGVyZmFjZSBSZWZTdG9yZSB7CiAgc2V0KGlkOiBzdHJpbmcsIG5leHQ6IHVua25vd24gfCAoKHByZXY6IHVua25vd24pID0+IHVua25vd24pKTogdm9pZDsKICBnZXQoaWQ6IHN0cmluZyk6IHVua25vd247CiAgd2F0Y2goaWQ6IHN0cmluZywgZm46IFJlZkxpc3RlbmVyKTogKCkgPT4gdm9pZDsKICByZWYoaWQ6IHN0cmluZywgaW5pdGlhbDogdW5rbm93bik6IFJlZk9iamVjdDsKfQoKaW50ZXJmYWNlIEVsZW1lbnRDb250ZXh0IHsKICBiaW5kOiB1bmtub3duOwogIGNvbnRyb2xsZXJzOiBNYXA8c3RyaW5nLCBBYm9ydENvbnRyb2xsZXI+OwogIHVubW91bnQ6IE1vZHVsZUVudHJ5W107Cn0KCnR5cGUgTW9kdWxlTmFtZXNwYWNlID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj47CgppbnRlcmZhY2UgR2xvYmFsQ2xpZW50V2luZG93IGV4dGVuZHMgV2luZG93IHsKICBfX3J1d3V0ZXI/OiB7CiAgICBzdG9yZT86IFJlZlN0b3JlOwogICAgbG9hZE1vZHVsZT86IChzcGVjOiBzdHJpbmcpID0+IFByb21pc2U8TW9kdWxlTmFtZXNwYWNlPjsKICB9Owp9Cgpjb25zdCBoYXNXaW5kb3cgPSB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIjsKCmZ1bmN0aW9uIGluaXRpYWxpemVDbGllbnRSdW50aW1lKCk6IHZvaWQgewogIGlmICghaGFzV2luZG93KSByZXR1cm47CiAgY29uc3QgZ2xvYmFsV2luZG93ID0gd2luZG93IGFzIEdsb2JhbENsaWVudFdpbmRvdzsKICBpZiAoZ2xvYmFsV2luZG93Ll9fcnV3dXRlcj8uc3RvcmUpIHJldHVybjsKICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIikgcmV0dXJuOwoKICBjb25zdCBsb2FkTW9kdWxlID0gKCgpID0+IHsKICAgIGNvbnN0IGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIFByb21pc2U8TW9kdWxlTmFtZXNwYWNlPj4oKTsKCiAgICBjb25zdCByZXNvbHZlID0gKHNwZWM6IHN0cmluZykgPT4gewogICAgICBpZiAoL15bYS16QS1aXVthLXpBLVowLTkrLi1dKjovLnRlc3Qoc3BlYykpIHJldHVybiBzcGVjOyAvLyBhbHJlYWR5IGFic29sdXRlIFVSTAogICAgICBpZiAoc3BlYy5zdGFydHNXaXRoKCIvIikpIHJldHVybiBuZXcgVVJMKHNwZWMsIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pLmhyZWY7CiAgICAgIC8vIFJlc29sdmUgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgZGlyZWN0b3J5LCBub3QgdHJlYXRpbmcgdGhlIGxhc3QgcGF0aCBzZWdtZW50IGFzIGEgZmlsZQogICAgICBjb25zdCBiYXNlRGlyID0gbmV3IFVSTCgiLiIsIHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKICAgICAgcmV0dXJuIG5ldyBVUkwoc3BlYywgYmFzZURpcikuaHJlZjsKICAgIH07CgogICAgcmV0dXJuIChzcGVjOiBzdHJpbmcpID0+IHsKICAgICAgY29uc3QgcmVzb2x2ZWQgPSByZXNvbHZlKHNwZWMpOwogICAgICBpZiAoIWNhY2hlLmhhcyhyZXNvbHZlZCkpIHsKICAgICAgICBjb25zdCBjdXN0b21Mb2FkZXIgPSBnbG9iYWxXaW5kb3cuX19ydXd1dGVyPy5sb2FkTW9kdWxlOwogICAgICAgIGNhY2hlLnNldCgKICAgICAgICAgIHJlc29sdmVkLAogICAgICAgICAgY3VzdG9tTG9hZGVyID8gY3VzdG9tTG9hZGVyKHJlc29sdmVkKSA6IGltcG9ydChyZXNvbHZlZCksCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gY2FjaGUuZ2V0KHJlc29sdmVkKSE7CiAgICB9OwogIH0pKCk7CgogIGNvbnN0IHN0b3JlOiBSZWZTdG9yZSA9ICgoKSA9PiB7CiAgICBjb25zdCB2YWx1ZXMgPSBuZXcgTWFwPHN0cmluZywgdW5rbm93bj4oKTsKICAgIGNvbnN0IGxpc3RlbmVycyA9IG5ldyBNYXA8c3RyaW5nLCBTZXQ8UmVmTGlzdGVuZXI+PigpOwogICAgY29uc3QgcmVmcyA9IG5ldyBNYXA8c3RyaW5nLCBSZWZPYmplY3Q+KCk7CgogICAgY29uc3QgZW5zdXJlID0gKGlkOiBzdHJpbmcsIGluaXRpYWw6IHVua25vd24pID0+IHsKICAgICAgaWYgKCF2YWx1ZXMuaGFzKGlkKSkgdmFsdWVzLnNldChpZCwgaW5pdGlhbCk7CiAgICAgIHJldHVybiB2YWx1ZXMuZ2V0KGlkKTsKICAgIH07CgogICAgY29uc3Qgc2V0ID0gKGlkOiBzdHJpbmcsIG5leHQ6IHVua25vd24gfCAoKHByZXY6IHVua25vd24pID0+IHVua25vd24pKSA9PiB7CiAgICAgIGNvbnN0IGN1cnJlbnQgPSB2YWx1ZXMuZ2V0KGlkKTsKICAgICAgY29uc3QgdmFsdWUgPSB0eXBlb2YgbmV4dCA9PT0gImZ1bmN0aW9uIgogICAgICAgID8gKG5leHQgYXMgKHByZXY6IHVua25vd24pID0+IHVua25vd24pKGN1cnJlbnQpCiAgICAgICAgOiBuZXh0OwogICAgICB2YWx1ZXMuc2V0KGlkLCB2YWx1ZSk7CiAgICAgIGNvbnN0IHN1YnMgPSBsaXN0ZW5lcnMuZ2V0KGlkKTsKICAgICAgaWYgKCFzdWJzKSByZXR1cm47CiAgICAgIGNvbnN0IHNuYXBzaG90ID0gQXJyYXkuZnJvbShzdWJzKTsKICAgICAgc25hcHNob3QuZm9yRWFjaCgoZm4pID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgZm4oKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIC8qIGlnbm9yZSBzdWJzY3JpYmVyIGVycm9ycyAqLwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIGNvbnN0IHdhdGNoID0gKGlkOiBzdHJpbmcsIGZuOiBSZWZMaXN0ZW5lcikgPT4gewogICAgICBsZXQgc3VicyA9IGxpc3RlbmVycy5nZXQoaWQpOwogICAgICBpZiAoIXN1YnMpIHsKICAgICAgICBzdWJzID0gbmV3IFNldDxSZWZMaXN0ZW5lcj4oKTsKICAgICAgICBsaXN0ZW5lcnMuc2V0KGlkLCBzdWJzKTsKICAgICAgfQogICAgICBzdWJzLmFkZChmbik7CiAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgY29uc3QgYnVja2V0ID0gbGlzdGVuZXJzLmdldChpZCk7CiAgICAgICAgaWYgKCFidWNrZXQpIHJldHVybjsKICAgICAgICBidWNrZXQuZGVsZXRlKGZuKTsKICAgICAgICBpZiAoYnVja2V0LnNpemUgPT09IDApIGxpc3RlbmVycy5kZWxldGUoaWQpOwogICAgICB9OwogICAgfTsKCiAgICBjb25zdCBjcmVhdGVSZWYgPSAoaWQ6IHN0cmluZywgaW5pdGlhbDogdW5rbm93bik6IFJlZk9iamVjdCA9PiB7CiAgICAgIGVuc3VyZShpZCwgaW5pdGlhbCk7CiAgICAgIGlmICghcmVmcy5oYXMoaWQpKSB7CiAgICAgICAgY29uc3QgcmVmOiBSZWZPYmplY3QgPSB7CiAgICAgICAgICBpZCwKICAgICAgICAgIGdldDogKCkgPT4gdmFsdWVzLmdldChpZCksCiAgICAgICAgICBzZXQ6IChuZXh0KSA9PiBzZXQoaWQsIG5leHQpLAogICAgICAgICAgdG9KU09OOiAoKSA9PiAoeyBfX3JlZjogdHJ1ZSBhcyBjb25zdCwgaTogaWQsIHY6IHZhbHVlcy5nZXQoaWQpIH0pLAogICAgICAgICAgdG9TdHJpbmc6ICgpID0+IFN0cmluZyh2YWx1ZXMuZ2V0KGlkKSksCiAgICAgICAgfTsKICAgICAgICByZWZzLnNldChpZCwgcmVmKTsKICAgICAgfQogICAgICByZXR1cm4gcmVmcy5nZXQoaWQpITsKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgc2V0LAogICAgICBnZXQ6IChpZDogc3RyaW5nKSA9PiB2YWx1ZXMuZ2V0KGlkKSwKICAgICAgd2F0Y2gsCiAgICAgIHJlZjogY3JlYXRlUmVmLAogICAgfTsKICB9KSgpOwoKICBjb25zdCBjb250ZXh0cyA9IG5ldyBXZWFrTWFwPEVsZW1lbnQsIEVsZW1lbnRDb250ZXh0PigpOwogIGNvbnN0IGh5ZHJhdGVkID0gbmV3IFNldDxzdHJpbmc+KCk7CgogIGZ1bmN0aW9uIHJldml2ZShfa2V5OiBzdHJpbmcsIHZhbHVlOiB1bmtub3duKTogdW5rbm93biB7CiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAib2JqZWN0IikgewogICAgICBjb25zdCByZWNvcmQgPSB2YWx1ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjsKICAgICAgaWYgKHJlY29yZC5fX3JlZiA9PT0gdHJ1ZSAmJiB0eXBlb2YgcmVjb3JkLmkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgY29uc3QgaWQgPSByZWNvcmQuaTsKICAgICAgICBjb25zdCBpbml0aWFsID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY29yZCwgInYiKSA/IHJlY29yZC52IDogdW5kZWZpbmVkOwogICAgICAgIHJldHVybiBzdG9yZS5yZWYoaWQsIGluaXRpYWwpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQoKICBmdW5jdGlvbiBwYXJzZVBheWxvYWQodGV4dDogc3RyaW5nKTogSHlkcmF0aW9uUGF5bG9hZCB7CiAgICB0cnkgewogICAgICByZXR1cm4gKEpTT04ucGFyc2UodGV4dCwgcmV2aXZlKSBhcyBIeWRyYXRpb25QYXlsb2FkKSA/PyB7fTsKICAgIH0gY2F0Y2ggewogICAgICByZXR1cm4ge307CiAgICB9CiAgfQoKICBhc3luYyBmdW5jdGlvbiByZXNvbHZlRW50cnkoZW50cnk/OiBNb2R1bGVFbnRyeSk6IFByb21pc2U8Q2xpZW50Rm4gfCB1bmRlZmluZWQ+IHsKICAgIGlmICghZW50cnkgfHwgZW50cnkudCAhPT0gIm0iKSByZXR1cm4gdW5kZWZpbmVkOwogICAgY29uc3QgbW9kID0gYXdhaXQgbG9hZE1vZHVsZShlbnRyeS5zKTsKICAgIGNvbnN0IGNhbmRpZGF0ZSA9IGVudHJ5LnggJiYgZW50cnkueCBpbiBtb2QgJiYgdHlwZW9mIG1vZFtlbnRyeS54XSA9PT0gImZ1bmN0aW9uIgogICAgICA/IChtb2RbZW50cnkueF0gYXMgQ2xpZW50Rm4pCiAgICAgIDogdHlwZW9mIG1vZC5kZWZhdWx0ID09PSAiZnVuY3Rpb24iCiAgICAgID8gKG1vZC5kZWZhdWx0IGFzIENsaWVudEZuKQogICAgICA6IHR5cGVvZiBtb2QgPT09ICJmdW5jdGlvbiIKICAgICAgPyAobW9kIGFzIHVua25vd24gYXMgQ2xpZW50Rm4pCiAgICAgIDogdW5kZWZpbmVkOwogICAgcmV0dXJuIGNhbmRpZGF0ZTsKICB9CgogIGZ1bmN0aW9uIGdldENvbnRleHQoZWw6IEVsZW1lbnQpOiBFbGVtZW50Q29udGV4dCB7CiAgICBsZXQgY3R4ID0gY29udGV4dHMuZ2V0KGVsKTsKICAgIGlmICghY3R4KSB7CiAgICAgIGN0eCA9IHsKICAgICAgICBiaW5kOiB1bmRlZmluZWQsCiAgICAgICAgY29udHJvbGxlcnM6IG5ldyBNYXA8c3RyaW5nLCBBYm9ydENvbnRyb2xsZXI+KCksCiAgICAgICAgdW5tb3VudDogW10sCiAgICAgIH07CiAgICAgIGNvbnRleHRzLnNldChlbCwgY3R4KTsKICAgIH0KICAgIHJldHVybiBjdHg7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBpbnZva2VFbnRyeSgKICAgIGVsOiBFbGVtZW50LAogICAgZW50cnk6IE1vZHVsZUVudHJ5LAogICAgdHlwZTogc3RyaW5nLAogICAgZXY6IEV2ZW50LAogICk6IFByb21pc2U8dm9pZD4gewogICAgY29uc3QgZm4gPSBhd2FpdCByZXNvbHZlRW50cnkoZW50cnkpOwogICAgaWYgKCFmbikgcmV0dXJuOwogICAgY29uc3QgY3R4ID0gZ2V0Q29udGV4dChlbCk7CiAgICBjb25zdCBjb250cm9sbGVycyA9IGN0eC5jb250cm9sbGVyczsKCiAgICBpZiAodHlwZSA9PT0gInVubW91bnQiKSB7CiAgICAgIGNvbnRyb2xsZXJzLmZvckVhY2goKGN0cmwpID0+IGN0cmwuYWJvcnQoKSk7CiAgICAgIGNvbnRyb2xsZXJzLmNsZWFyKCk7CiAgICB9CgogICAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGlmICh0eXBlKSB7CiAgICAgIGNvbnRyb2xsZXJzLmdldCh0eXBlKT8uYWJvcnQoKTsKICAgICAgY29udHJvbGxlcnMuc2V0KHR5cGUsIGNvbnRyb2xsZXIpOwogICAgfQoKICAgIHRyeSB7CiAgICAgIGF3YWl0IGZuLmNhbGwoY3R4LmJpbmQgPz8gZWwsIGV2LCBjb250cm9sbGVyLnNpZ25hbCk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgaWYgKAogICAgICAgIGNvbnRyb2xsZXIuc2lnbmFsLmFib3J0ZWQgfHwKICAgICAgICAoZXJyIGluc3RhbmNlb2YgRXJyb3IgJiYgZXJyLm5hbWUgPT09ICJBYm9ydEVycm9yIikKICAgICAgKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmICh0eXBlICYmIGNvbnRyb2xsZXJzLmdldCh0eXBlKSA9PT0gY29udHJvbGxlcikgewogICAgICAgIGNvbnRyb2xsZXJzLmRlbGV0ZSh0eXBlKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gYXR0YWNoSGFuZGxlcihlbDogRWxlbWVudCwgZW50cnk6IE1vZHVsZUVudHJ5KTogdm9pZCB7CiAgICBpZiAoIWVudHJ5IHx8IGVudHJ5LnQgIT09ICJtIikgcmV0dXJuOwogICAgY29uc3QgdHlwZSA9IGVudHJ5LmV2ICYmIGVudHJ5LmV2Lmxlbmd0aCA+IDAgPyBlbnRyeS5ldiA6ICJjbGljayI7CgogICAgaWYgKHR5cGUgPT09ICJtb3VudCIpIHsKICAgICAgcXVldWVNaWNyb3Rhc2soKCkgPT4gaW52b2tlRW50cnkoZWwsIGVudHJ5LCAibW91bnQiLCBuZXcgRXZlbnQoIm1vdW50IikpKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGN0eCA9IGdldENvbnRleHQoZWwpOwogICAgaWYgKHR5cGUgPT09ICJ1bm1vdW50IikgewogICAgICBjdHgudW5tb3VudC5wdXNoKGVudHJ5KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbGlzdGVuZXJPcHRpb25zID0gZW50cnkub3B0CiAgICAgID8gewogICAgICAgIGNhcHR1cmU6IGVudHJ5Lm9wdC5jYXB0dXJlLAogICAgICAgIG9uY2U6IGVudHJ5Lm9wdC5vbmNlLAogICAgICAgIHBhc3NpdmU6IGVudHJ5Lm9wdC5wYXNzaXZlLAogICAgICB9CiAgICAgIDogdW5kZWZpbmVkOwogICAgY29uc3QgcHJldmVudERlZmF1bHQgPSBlbnRyeS5vcHQ/LnByZXZlbnREZWZhdWx0ID09PSB0cnVlICYmIGVudHJ5Lm9wdC5wYXNzaXZlICE9PSB0cnVlOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoZXZlbnQpID0+IHsKICAgICAgaWYgKHByZXZlbnREZWZhdWx0ICYmIGV2ZW50LmNhbmNlbGFibGUpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICAgIHZvaWQgaW52b2tlRW50cnkoZWwsIGVudHJ5LCB0eXBlLCBldmVudCk7CiAgICB9LCBsaXN0ZW5lck9wdGlvbnMpOwogIH0KCiAgZnVuY3Rpb24gaHlkcmF0ZVBheWxvYWQoZWw6IEVsZW1lbnQsIHBheWxvYWQ6IEh5ZHJhdGlvblBheWxvYWQpOiB2b2lkIHsKICAgIGlmICghcGF5bG9hZCB8fCB0eXBlb2YgcGF5bG9hZCAhPT0gIm9iamVjdCIpIHJldHVybjsKICAgIGNvbnN0IGN0eCA9IGdldENvbnRleHQoZWwpOwoKICAgIGlmICgiYmluZCIgaW4gcGF5bG9hZCkgewogICAgICBjdHguYmluZCA9IHBheWxvYWQuYmluZDsKICAgIH0KCiAgICBwYXlsb2FkLm9uPy5mb3JFYWNoKChlbnRyeSkgPT4gYXR0YWNoSGFuZGxlcihlbCwgZW50cnkpKTsKICB9CgogIGZ1bmN0aW9uIGZpbmRIeWRyYXRpb25FbGVtZW50KHNjcmlwdDogSFRNTFNjcmlwdEVsZW1lbnQpOiBFbGVtZW50IHwgbnVsbCB7CiAgICBjb25zdCBpZCA9IHNjcmlwdC5nZXRBdHRyaWJ1dGUoImRhdGEtaHlkcmF0ZSIpID8/ICIiOwogICAgaWYgKCFpZCkgcmV0dXJuIG51bGw7CgogICAgbGV0IG5vZGU6IENoaWxkTm9kZSB8IG51bGwgPSBzY3JpcHQucHJldmlvdXNTaWJsaW5nOwogICAgd2hpbGUgKG5vZGUpIHsKICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICAgICAgcmV0dXJuIG5vZGUgYXMgRWxlbWVudDsKICAgICAgfQogICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5DT01NRU5UX05PREUpIHsKICAgICAgICBjb25zdCBjb21tZW50ID0gbm9kZSBhcyBDb21tZW50OwogICAgICAgIGlmIChjb21tZW50LmRhdGEgPT09IGAvcnc6aDoke2lkfWAgfHwgY29tbWVudC5kYXRhID09PSBgL2h5ZHJhdGlvbi1ib3VuZGFyeToke2lkfWApIHsKICAgICAgICAgIGxldCBwcmV2OiBDaGlsZE5vZGUgfCBudWxsID0gY29tbWVudC5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgICB3aGlsZSAocHJldiAmJiBwcmV2Lm5vZGVUeXBlICE9PSBOb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICBwcmV2ID0gcHJldi5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocHJldiAmJiBwcmV2Lm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICByZXR1cm4gcHJldiBhcyBFbGVtZW50OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY29tbWVudC5kYXRhID09PSBgaHlkcmF0aW9uLWJvdW5kYXJ5OiR7aWR9YCkgewogICAgICAgICAgbGV0IG5leHQ6IENoaWxkTm9kZSB8IG51bGwgPSBjb21tZW50Lm5leHRTaWJsaW5nOwogICAgICAgICAgd2hpbGUgKG5leHQgJiYgbmV4dC5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgbmV4dCA9IG5leHQubmV4dFNpYmxpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobmV4dCAmJiBuZXh0Lm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICByZXR1cm4gbmV4dCBhcyBFbGVtZW50OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmc7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIGh5ZHJhdGVTY3JpcHQoc2NyaXB0OiBIVE1MU2NyaXB0RWxlbWVudCk6IHZvaWQgewogICAgY29uc3QgaWQgPSBzY3JpcHQuZ2V0QXR0cmlidXRlKCJkYXRhLWh5ZHJhdGUiKSA/PyAiIjsKICAgIGlmICghaWQgfHwgaHlkcmF0ZWQuaGFzKGlkKSkgcmV0dXJuOwoKICAgIGNvbnN0IGVsID0gZmluZEh5ZHJhdGlvbkVsZW1lbnQoc2NyaXB0KTsKICAgIGlmICghZWwpIHJldHVybjsKCiAgICBjb25zdCBwYXlsb2FkID0gcGFyc2VQYXlsb2FkKHNjcmlwdC50ZXh0Q29udGVudCA/PyAie30iKTsKICAgIGh5ZHJhdGVQYXlsb2FkKGVsLCBwYXlsb2FkKTsKICAgIGh5ZHJhdGVkLmFkZChpZCk7CiAgfQoKICBmdW5jdGlvbiB0ZWFyZG93bkVsZW1lbnQoZWw6IEVsZW1lbnQpOiB2b2lkIHsKICAgIGNvbnN0IGN0eCA9IGNvbnRleHRzLmdldChlbCk7CiAgICBpZiAoIWN0eCkgcmV0dXJuOwoKICAgIGN0eC5jb250cm9sbGVycy5mb3JFYWNoKChjdHJsKSA9PiBjdHJsLmFib3J0KCkpOwogICAgY3R4LmNvbnRyb2xsZXJzLmNsZWFyKCk7CgogICAgaWYgKGN0eC51bm1vdW50Lmxlbmd0aCkgewogICAgICBjdHgudW5tb3VudC5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIHZvaWQgaW52b2tlRW50cnkoZWwsIGVudHJ5LCAidW5tb3VudCIsIG5ldyBFdmVudCgidW5tb3VudCIpKTsKICAgICAgfSk7CiAgICAgIGN0eC51bm1vdW50Lmxlbmd0aCA9IDA7CiAgICB9CgogICAgY29udGV4dHMuZGVsZXRlKGVsKTsKICB9CgogIGNvbnN0IGlzSHlkcmF0aW9uU2NyaXB0ID0gKG5vZGU6IE5vZGUpOiBub2RlIGlzIEhUTUxTY3JpcHRFbGVtZW50ID0+CiAgICBub2RlIGluc3RhbmNlb2YgSFRNTFNjcmlwdEVsZW1lbnQgJiYKICAgIChub2RlLmdldEF0dHJpYnV0ZSgidHlwZSIpIHx8ICIiKS50b0xvd2VyQ2FzZSgpID09PSAiYXBwbGljYXRpb24vanNvbiIgJiYKICAgIG5vZGUuaGFzQXR0cmlidXRlKCJkYXRhLWh5ZHJhdGUiKTsKCiAgZnVuY3Rpb24gc2VlZCgpOiB2b2lkIHsKICAgIGRvY3VtZW50CiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHRbdHlwZT0iYXBwbGljYXRpb24vanNvbiJdW2RhdGEtaHlkcmF0ZV0nKQogICAgICAuZm9yRWFjaCgobm9kZSkgPT4gaHlkcmF0ZVNjcmlwdChub2RlIGFzIEhUTUxTY3JpcHRFbGVtZW50KSk7CiAgfQoKICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHsKICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zKSB7CiAgICAgIG11dGF0aW9uLmFkZGVkTm9kZXM/LmZvckVhY2goKG5vZGUpID0+IHsKICAgICAgICBpZiAoIShub2RlIGluc3RhbmNlb2YgRWxlbWVudCkpIHJldHVybjsKICAgICAgICBpZiAoaXNIeWRyYXRpb25TY3JpcHQobm9kZSkpIHsKICAgICAgICAgIGh5ZHJhdGVTY3JpcHQobm9kZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIG5vZGUKICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHRbdHlwZT0iYXBwbGljYXRpb24vanNvbiJdW2RhdGEtaHlkcmF0ZV0nKQogICAgICAgICAgLmZvckVhY2goKHNjcmlwdCkgPT4gaHlkcmF0ZVNjcmlwdChzY3JpcHQgYXMgSFRNTFNjcmlwdEVsZW1lbnQpKTsKICAgICAgfSk7CgogICAgICBtdXRhdGlvbi5yZW1vdmVkTm9kZXM/LmZvckVhY2goKG5vZGUpID0+IHsKICAgICAgICBpZiAoIShub2RlIGluc3RhbmNlb2YgRWxlbWVudCkpIHJldHVybjsKICAgICAgICB0ZWFyZG93bkVsZW1lbnQobm9kZSk7CiAgICAgICAgbm9kZS5xdWVyeVNlbGVjdG9yQWxsKCIqIikuZm9yRWFjaCgoY2hpbGQpID0+IHsKICAgICAgICAgIHRlYXJkb3duRWxlbWVudChjaGlsZCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0pOwoKICBzZWVkKCk7CiAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudCwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfSk7CgogIGdsb2JhbFdpbmRvdy5fX3J1d3V0ZXIgPSBPYmplY3QuYXNzaWduKGdsb2JhbFdpbmRvdy5fX3J1d3V0ZXIgPz8ge30sIHsKICAgIHN0b3JlLAogIH0pOwp9CgppZiAoaGFzV2luZG93KSB7CiAgaW5pdGlhbGl6ZUNsaWVudFJ1bnRpbWUoKTsKfQoKZXhwb3J0IHt9Owo=" as const;

let instance = 0;

export const nextClientRuntimeUrl = () =>
  `data:application/typescript;base64,${CLIENT_RUNTIME_BASE64}#${instance++}`;
