// Generated from src/runtime/client.mts using
//   base64 -w0 src/runtime/client.mts
// Update alongside runtime changes to keep DOM tests in sync.

const CLIENT_RUNTIME_BASE64 = "dHlwZSBSZWZMaXN0ZW5lciA9ICgpID0+IHZvaWQ7Cgp0eXBlIE1vZHVsZUVudHJ5ID0gewogIHQ6ICJtIjsKICBzOiBzdHJpbmc7CiAgeD86IHN0cmluZzsKICBldj86IHN0cmluZzsKfTsKCnR5cGUgQXR0ckVudHJ5ID0gewogIG46IHN0cmluZzsKICBlOiBNb2R1bGVFbnRyeTsKICBhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47Cn07Cgp0eXBlIEh5ZHJhdGlvblBheWxvYWQgPSB7CiAgYmluZD86IHVua25vd247CiAgb24/OiBNb2R1bGVFbnRyeVtdOwogIGF0dHJzPzogQXR0ckVudHJ5W107Cn07Cgp0eXBlIENsaWVudEZuID0gKHRoaXM6IHVua25vd24sIGV2OiBFdmVudCwgc2lnbmFsOiBBYm9ydFNpZ25hbCkgPT4gdW5rbm93bjsKCmludGVyZmFjZSBSZWZPYmplY3QgewogIGlkOiBzdHJpbmc7CiAgZ2V0KCk6IHVua25vd247CiAgc2V0KG5leHQ6IHVua25vd24gfCAoKHByZXY6IHVua25vd24pID0+IHVua25vd24pKTogdm9pZDsKICB0b0pTT04oKTogeyBfX3JlZjogdHJ1ZTsgaTogc3RyaW5nOyB2OiB1bmtub3duIH07Cn0KCmludGVyZmFjZSBSZWZTdG9yZSB7CiAgc2V0KGlkOiBzdHJpbmcsIG5leHQ6IHVua25vd24gfCAoKHByZXY6IHVua25vd24pID0+IHVua25vd24pKTogdm9pZDsKICBnZXQoaWQ6IHN0cmluZyk6IHVua25vd247CiAgd2F0Y2goaWQ6IHN0cmluZywgZm46IFJlZkxpc3RlbmVyKTogKCkgPT4gdm9pZDsKICByZWYoaWQ6IHN0cmluZywgaW5pdGlhbDogdW5rbm93bik6IFJlZk9iamVjdDsKfQoKaW50ZXJmYWNlIEVsZW1lbnRDb250ZXh0IHsKICBiaW5kOiB1bmtub3duOwogIGNvbnRyb2xsZXJzOiBNYXA8c3RyaW5nLCBBYm9ydENvbnRyb2xsZXI+OwogIHVubW91bnQ6IE1vZHVsZUVudHJ5W107CiAgYXR0ckNsZWFudXBzOiBNYXA8c3RyaW5nLCAoKSA9PiB2b2lkPjsKICBhdHRyU2NvcGVzOiBNYXA8c3RyaW5nLCBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj47Cn0KCnR5cGUgTW9kdWxlTmFtZXNwYWNlID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj47CgppbnRlcmZhY2UgR2xvYmFsQ2xpZW50V2luZG93IGV4dGVuZHMgV2luZG93IHsKICBfX3J1d3V0ZXI/OiB7CiAgICBzdG9yZT86IFJlZlN0b3JlOwogICAgbG9hZE1vZHVsZT86IChzcGVjOiBzdHJpbmcpID0+IFByb21pc2U8TW9kdWxlTmFtZXNwYWNlPjsKICB9Owp9Cgpjb25zdCBoYXNXaW5kb3cgPSB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIjsKCmZ1bmN0aW9uIGluaXRpYWxpemVDbGllbnRSdW50aW1lKCk6IHZvaWQgewogIGlmICghaGFzV2luZG93KSByZXR1cm47CiAgY29uc3QgZ2xvYmFsV2luZG93ID0gd2luZG93IGFzIEdsb2JhbENsaWVudFdpbmRvdzsKICBpZiAoZ2xvYmFsV2luZG93Ll9fcnV3dXRlcj8uc3RvcmUpIHJldHVybjsKICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIikgcmV0dXJuOwoKICBjb25zdCBsb2FkTW9kdWxlID0gKCgpID0+IHsKICAgIGNvbnN0IGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIFByb21pc2U8TW9kdWxlTmFtZXNwYWNlPj4oKTsKCiAgICBjb25zdCByZXNvbHZlID0gKHNwZWM6IHN0cmluZykgPT4gewogICAgICBpZiAoL15bYS16QS1aXVthLXpBLVowLTkrLi1dKjovLnRlc3Qoc3BlYykpIHJldHVybiBzcGVjOyAvLyBhbHJlYWR5IGFic29sdXRlIFVSTAogICAgICBpZiAoc3BlYy5zdGFydHNXaXRoKCIvIikpIHJldHVybiBuZXcgVVJMKHNwZWMsIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pLmhyZWY7CiAgICAgIC8vIFJlc29sdmUgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgZGlyZWN0b3J5LCBub3QgdHJlYXRpbmcgdGhlIGxhc3QgcGF0aCBzZWdtZW50IGFzIGEgZmlsZQogICAgICBjb25zdCBiYXNlRGlyID0gbmV3IFVSTCgiLiIsIHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKICAgICAgcmV0dXJuIG5ldyBVUkwoc3BlYywgYmFzZURpcikuaHJlZjsKICAgIH07CgogICAgcmV0dXJuIChzcGVjOiBzdHJpbmcpID0+IHsKICAgICAgY29uc3QgcmVzb2x2ZWQgPSByZXNvbHZlKHNwZWMpOwogICAgICBpZiAoIWNhY2hlLmhhcyhyZXNvbHZlZCkpIHsKICAgICAgICBjb25zdCBjdXN0b21Mb2FkZXIgPSBnbG9iYWxXaW5kb3cuX19ydXd1dGVyPy5sb2FkTW9kdWxlOwogICAgICAgIGNhY2hlLnNldCgKICAgICAgICAgIHJlc29sdmVkLAogICAgICAgICAgY3VzdG9tTG9hZGVyID8gY3VzdG9tTG9hZGVyKHJlc29sdmVkKSA6IGltcG9ydChyZXNvbHZlZCksCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gY2FjaGUuZ2V0KHJlc29sdmVkKSE7CiAgICB9OwogIH0pKCk7CgogIGNvbnN0IHN0b3JlOiBSZWZTdG9yZSA9ICgoKSA9PiB7CiAgICBjb25zdCB2YWx1ZXMgPSBuZXcgTWFwPHN0cmluZywgdW5rbm93bj4oKTsKICAgIGNvbnN0IGxpc3RlbmVycyA9IG5ldyBNYXA8c3RyaW5nLCBTZXQ8UmVmTGlzdGVuZXI+PigpOwogICAgY29uc3QgcmVmcyA9IG5ldyBNYXA8c3RyaW5nLCBSZWZPYmplY3Q+KCk7CgogICAgY29uc3QgZW5zdXJlID0gKGlkOiBzdHJpbmcsIGluaXRpYWw6IHVua25vd24pID0+IHsKICAgICAgaWYgKCF2YWx1ZXMuaGFzKGlkKSkgdmFsdWVzLnNldChpZCwgaW5pdGlhbCk7CiAgICAgIHJldHVybiB2YWx1ZXMuZ2V0KGlkKTsKICAgIH07CgogICAgY29uc3Qgc2V0ID0gKGlkOiBzdHJpbmcsIG5leHQ6IHVua25vd24gfCAoKHByZXY6IHVua25vd24pID0+IHVua25vd24pKSA9PiB7CiAgICAgIGNvbnN0IGN1cnJlbnQgPSB2YWx1ZXMuZ2V0KGlkKTsKICAgICAgY29uc3QgdmFsdWUgPSB0eXBlb2YgbmV4dCA9PT0gImZ1bmN0aW9uIgogICAgICAgID8gKG5leHQgYXMgKHByZXY6IHVua25vd24pID0+IHVua25vd24pKGN1cnJlbnQpCiAgICAgICAgOiBuZXh0OwogICAgICB2YWx1ZXMuc2V0KGlkLCB2YWx1ZSk7CiAgICAgIGNvbnN0IHN1YnMgPSBsaXN0ZW5lcnMuZ2V0KGlkKTsKICAgICAgaWYgKCFzdWJzKSByZXR1cm47CiAgICAgIGNvbnN0IHNuYXBzaG90ID0gQXJyYXkuZnJvbShzdWJzKTsKICAgICAgc25hcHNob3QuZm9yRWFjaCgoZm4pID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgZm4oKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIC8qIGlnbm9yZSBzdWJzY3JpYmVyIGVycm9ycyAqLwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIGNvbnN0IHdhdGNoID0gKGlkOiBzdHJpbmcsIGZuOiBSZWZMaXN0ZW5lcikgPT4gewogICAgICBsZXQgc3VicyA9IGxpc3RlbmVycy5nZXQoaWQpOwogICAgICBpZiAoIXN1YnMpIHsKICAgICAgICBzdWJzID0gbmV3IFNldDxSZWZMaXN0ZW5lcj4oKTsKICAgICAgICBsaXN0ZW5lcnMuc2V0KGlkLCBzdWJzKTsKICAgICAgfQogICAgICBzdWJzLmFkZChmbik7CiAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgY29uc3QgYnVja2V0ID0gbGlzdGVuZXJzLmdldChpZCk7CiAgICAgICAgaWYgKCFidWNrZXQpIHJldHVybjsKICAgICAgICBidWNrZXQuZGVsZXRlKGZuKTsKICAgICAgICBpZiAoYnVja2V0LnNpemUgPT09IDApIGxpc3RlbmVycy5kZWxldGUoaWQpOwogICAgICB9OwogICAgfTsKCiAgICBjb25zdCBjcmVhdGVSZWYgPSAoaWQ6IHN0cmluZywgaW5pdGlhbDogdW5rbm93bik6IFJlZk9iamVjdCA9PiB7CiAgICAgIGVuc3VyZShpZCwgaW5pdGlhbCk7CiAgICAgIGlmICghcmVmcy5oYXMoaWQpKSB7CiAgICAgICAgY29uc3QgcmVmOiBSZWZPYmplY3QgPSB7CiAgICAgICAgICBpZCwKICAgICAgICAgIGdldDogKCkgPT4gdmFsdWVzLmdldChpZCksCiAgICAgICAgICBzZXQ6IChuZXh0KSA9PiBzZXQoaWQsIG5leHQpLAogICAgICAgICAgdG9KU09OOiAoKSA9PiAoeyBfX3JlZjogdHJ1ZSBhcyBjb25zdCwgaTogaWQsIHY6IHZhbHVlcy5nZXQoaWQpIH0pLAogICAgICAgIH07CiAgICAgICAgcmVmcy5zZXQoaWQsIHJlZik7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlZnMuZ2V0KGlkKSE7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgIHNldCwKICAgICAgZ2V0OiAoaWQ6IHN0cmluZykgPT4gdmFsdWVzLmdldChpZCksCiAgICAgIHdhdGNoLAogICAgICByZWY6IGNyZWF0ZVJlZiwKICAgIH07CiAgfSkoKTsKCiAgY29uc3QgY29udGV4dHMgPSBuZXcgV2Vha01hcDxFbGVtZW50LCBFbGVtZW50Q29udGV4dD4oKTsKICBjb25zdCBoeWRyYXRlZCA9IG5ldyBTZXQ8c3RyaW5nPigpOwoKICBmdW5jdGlvbiByZXZpdmUoX2tleTogc3RyaW5nLCB2YWx1ZTogdW5rbm93bik6IHVua25vd24gewogICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIpIHsKICAgICAgY29uc3QgcmVjb3JkID0gdmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47CiAgICAgIGlmIChyZWNvcmQuX19yZWYgPT09IHRydWUgJiYgdHlwZW9mIHJlY29yZC5pID09PSAic3RyaW5nIikgewogICAgICAgIGNvbnN0IGlkID0gcmVjb3JkLmk7CiAgICAgICAgY29uc3QgaW5pdGlhbCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZWNvcmQsICJ2IikgPyByZWNvcmQudiA6IHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gc3RvcmUucmVmKGlkLCBpbml0aWFsKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHZhbHVlOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VQYXlsb2FkKHRleHQ6IHN0cmluZyk6IEh5ZHJhdGlvblBheWxvYWQgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIChKU09OLnBhcnNlKHRleHQsIHJldml2ZSkgYXMgSHlkcmF0aW9uUGF5bG9hZCkgPz8ge307CiAgICB9IGNhdGNoIHsKICAgICAgcmV0dXJuIHt9OwogICAgfQogIH0KCiAgYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZUVudHJ5KGVudHJ5PzogTW9kdWxlRW50cnkpOiBQcm9taXNlPENsaWVudEZuIHwgdW5kZWZpbmVkPiB7CiAgICBpZiAoIWVudHJ5IHx8IGVudHJ5LnQgIT09ICJtIikgcmV0dXJuIHVuZGVmaW5lZDsKICAgIGNvbnN0IG1vZCA9IGF3YWl0IGxvYWRNb2R1bGUoZW50cnkucyk7CiAgICBjb25zdCBjYW5kaWRhdGUgPSBlbnRyeS54ICYmIGVudHJ5LnggaW4gbW9kICYmIHR5cGVvZiBtb2RbZW50cnkueF0gPT09ICJmdW5jdGlvbiIKICAgICAgPyAobW9kW2VudHJ5LnhdIGFzIENsaWVudEZuKQogICAgICA6IHR5cGVvZiBtb2QuZGVmYXVsdCA9PT0gImZ1bmN0aW9uIgogICAgICA/IChtb2QuZGVmYXVsdCBhcyBDbGllbnRGbikKICAgICAgOiB0eXBlb2YgbW9kID09PSAiZnVuY3Rpb24iCiAgICAgID8gKG1vZCBhcyB1bmtub3duIGFzIENsaWVudEZuKQogICAgICA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBjYW5kaWRhdGU7CiAgfQoKICBmdW5jdGlvbiBnZXRDb250ZXh0KGVsOiBFbGVtZW50KTogRWxlbWVudENvbnRleHQgewogICAgbGV0IGN0eCA9IGNvbnRleHRzLmdldChlbCk7CiAgICBpZiAoIWN0eCkgewogICAgICBjdHggPSB7CiAgICAgICAgYmluZDogdW5kZWZpbmVkLAogICAgICAgIGNvbnRyb2xsZXJzOiBuZXcgTWFwPHN0cmluZywgQWJvcnRDb250cm9sbGVyPigpLAogICAgICAgIHVubW91bnQ6IFtdLAogICAgICAgIGF0dHJDbGVhbnVwczogbmV3IE1hcDxzdHJpbmcsICgpID0+IHZvaWQ+KCksCiAgICAgICAgYXR0clNjb3BlczogbmV3IE1hcDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIHVua25vd24+PigpLAogICAgICB9OwogICAgICBjb250ZXh0cy5zZXQoZWwsIGN0eCk7CiAgICB9CiAgICByZXR1cm4gY3R4OwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gaW52b2tlRW50cnkoCiAgICBlbDogRWxlbWVudCwKICAgIGVudHJ5OiBNb2R1bGVFbnRyeSwKICAgIHR5cGU6IHN0cmluZywKICAgIGV2OiBFdmVudCwKICApOiBQcm9taXNlPHZvaWQ+IHsKICAgIGNvbnN0IGZuID0gYXdhaXQgcmVzb2x2ZUVudHJ5KGVudHJ5KTsKICAgIGlmICghZm4pIHJldHVybjsKICAgIGNvbnN0IGN0eCA9IGdldENvbnRleHQoZWwpOwogICAgY29uc3QgY29udHJvbGxlcnMgPSBjdHguY29udHJvbGxlcnM7CgogICAgaWYgKHR5cGUgPT09ICJ1bm1vdW50IikgewogICAgICBjb250cm9sbGVycy5mb3JFYWNoKChjdHJsKSA9PiBjdHJsLmFib3J0KCkpOwogICAgICBjb250cm9sbGVycy5jbGVhcigpOwogICAgfQoKICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBpZiAodHlwZSkgewogICAgICBjb250cm9sbGVycy5nZXQodHlwZSk/LmFib3J0KCk7CiAgICAgIGNvbnRyb2xsZXJzLnNldCh0eXBlLCBjb250cm9sbGVyKTsKICAgIH0KCiAgICB0cnkgewogICAgICBhd2FpdCBmbi5jYWxsKGN0eC5iaW5kID8/IGVsLCBldiwgY29udHJvbGxlci5zaWduYWwpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGlmICgKICAgICAgICBjb250cm9sbGVyLnNpZ25hbC5hYm9ydGVkIHx8CiAgICAgICAgKGVyciBpbnN0YW5jZW9mIEVycm9yICYmIGVyci5uYW1lID09PSAiQWJvcnRFcnJvciIpCiAgICAgICkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAodHlwZSAmJiBjb250cm9sbGVycy5nZXQodHlwZSkgPT09IGNvbnRyb2xsZXIpIHsKICAgICAgICBjb250cm9sbGVycy5kZWxldGUodHlwZSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGF0dGFjaEhhbmRsZXIoZWw6IEVsZW1lbnQsIGVudHJ5OiBNb2R1bGVFbnRyeSk6IHZvaWQgewogICAgaWYgKCFlbnRyeSB8fCBlbnRyeS50ICE9PSAibSIpIHJldHVybjsKICAgIGNvbnN0IHR5cGUgPSBlbnRyeS5ldiAmJiBlbnRyeS5ldi5sZW5ndGggPiAwID8gZW50cnkuZXYgOiAiY2xpY2siOwoKICAgIGlmICh0eXBlID09PSAibW91bnQiKSB7CiAgICAgIHF1ZXVlTWljcm90YXNrKCgpID0+IGludm9rZUVudHJ5KGVsLCBlbnRyeSwgIm1vdW50IiwgbmV3IEV2ZW50KCJtb3VudCIpKSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBjdHggPSBnZXRDb250ZXh0KGVsKTsKICAgIGlmICh0eXBlID09PSAidW5tb3VudCIpIHsKICAgICAgY3R4LnVubW91bnQucHVzaChlbnRyeSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBlbC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldmVudCkgPT4gewogICAgICB2b2lkIGludm9rZUVudHJ5KGVsLCBlbnRyeSwgdHlwZSwgZXZlbnQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBzZXRDb21wdXRlZEF0dHIoZWw6IEVsZW1lbnQsIG5hbWU6IHN0cmluZywgdmFsdWU6IHVua25vd24pOiB2b2lkIHsKICAgIGlmIChuYW1lID09PSAiY2xhc3MiKSB7CiAgICAgIGNvbnN0IHRleHQgPSB2YWx1ZSA9PSBudWxsID8gIiIgOiBTdHJpbmcodmFsdWUpOwogICAgICBlbC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgdGV4dCk7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCJjbGFzc05hbWUiIGluIGVsKSAoZWwgYXMgSFRNTEVsZW1lbnQpLmNsYXNzTmFtZSA9IHRleHQ7CiAgICAgIH0gY2F0Y2ggewogICAgICAgIC8qIGlnbm9yZSAqLwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAobmFtZSA9PT0gImhpZGRlbiIgfHwgbmFtZSA9PT0gImRpc2FibGVkIiB8fCBuYW1lID09PSAiaW5lcnQiKSB7CiAgICAgIGlmICh2YWx1ZSkgZWwuc2V0QXR0cmlidXRlKG5hbWUsICIiKTsKICAgICAgZWxzZSBlbC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7CiAgICB9IGVsc2UgewogICAgICBlbC5zZXRBdHRyaWJ1dGUobmFtZSwgU3RyaW5nKHZhbHVlKSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpc1JlZk9iamVjdCh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIFJlZk9iamVjdCB7CiAgICBpZiAoIXZhbHVlIHx8IHR5cGVvZiB2YWx1ZSAhPT0gIm9iamVjdCIpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IHJlY29yZCA9IHZhbHVlIGFzIFBhcnRpYWw8UmVmT2JqZWN0PjsKICAgIHJldHVybiAoCiAgICAgIHR5cGVvZiByZWNvcmQuaWQgPT09ICJzdHJpbmciICYmCiAgICAgIHR5cGVvZiByZWNvcmQuZ2V0ID09PSAiZnVuY3Rpb24iICYmCiAgICAgIHR5cGVvZiByZWNvcmQuc2V0ID09PSAiZnVuY3Rpb24iCiAgICApOwogIH0KCiAgZnVuY3Rpb24gY29sbGVjdFJlZnMoCiAgICB2YWx1ZTogdW5rbm93biwKICAgIHZpc2l0OiAocmVmOiBSZWZPYmplY3QpID0+IHZvaWQsCiAgICBzZWVuOiBTZXQ8dW5rbm93bj4gPSBuZXcgU2V0KCksCiAgKTogdm9pZCB7CiAgICBpZiAoIXZhbHVlIHx8IHR5cGVvZiB2YWx1ZSAhPT0gIm9iamVjdCIgfHwgc2Vlbi5oYXModmFsdWUpKSByZXR1cm47CiAgICBzZWVuLmFkZCh2YWx1ZSk7CgogICAgaWYgKGlzUmVmT2JqZWN0KHZhbHVlKSkgewogICAgICB2aXNpdCh2YWx1ZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgdmFsdWUuZm9yRWFjaCgoaXRlbSkgPT4gY29sbGVjdFJlZnMoaXRlbSwgdmlzaXQsIHNlZW4pKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHZhbHVlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KSkgewogICAgICBjb2xsZWN0UmVmcygodmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pW2tleV0sIHZpc2l0LCBzZWVuKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGJpbmRDb21wdXRlZEF0dHIoZWw6IEVsZW1lbnQsIHNwZWM6IEF0dHJFbnRyeSk6IHZvaWQgewogICAgaWYgKCFzcGVjIHx8IHR5cGVvZiBzcGVjLm4gIT09ICJzdHJpbmciIHx8ICFzcGVjLmUgfHwgc3BlYy5lLnQgIT09ICJtIikgcmV0dXJuOwoKICAgIGNvbnN0IGN0eCA9IGdldENvbnRleHQoZWwpOwogICAgY29uc3Qga2V5ID0gYCR7c3BlYy5ufToke3NwZWMuZS5zfToke3NwZWMuZS54ID8/ICIifWA7CgogICAgY3R4LmF0dHJDbGVhbnVwcy5nZXQoa2V5KT8uKCk7CgogICAgaWYgKCFjdHguYXR0clNjb3Blcy5oYXMoa2V5KSkgewogICAgICBjb25zdCBhcmdzID0gc3BlYy5hICYmIHR5cGVvZiBzcGVjLmEgPT09ICJvYmplY3QiID8gc3BlYy5hIDoge307CiAgICAgIGN0eC5hdHRyU2NvcGVzLnNldChrZXksIGFyZ3MgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOwogICAgfQogICAgY29uc3Qgc2NvcGUgPSBjdHguYXR0clNjb3Blcy5nZXQoa2V5KSE7CgogICAgY29uc3QgdW5zdWJzID0gbmV3IFNldDwoKSA9PiB2b2lkPigpOwogICAgbGV0IHRva2VuID0gMDsKCiAgICBjb25zdCBydW4gPSBhc3luYyAoKSA9PiB7CiAgICAgIGNvbnN0IGN1cnJlbnQgPSArK3Rva2VuOwogICAgICB1bnN1YnMuZm9yRWFjaCgoZGlzcG9zZSkgPT4gZGlzcG9zZSgpKTsKICAgICAgdW5zdWJzLmNsZWFyKCk7CgogICAgICBjb25zdCBmbiA9IGF3YWl0IHJlc29sdmVFbnRyeShzcGVjLmUpOwogICAgICBpZiAodG9rZW4gIT09IGN1cnJlbnQgfHwgIWZuKSByZXR1cm47CgogICAgICBsZXQgcmVzdWx0OiB1bmtub3duOwogICAgICB0cnkgewogICAgICAgIHJlc3VsdCA9IGF3YWl0IGZuLmNhbGwoc2NvcGUsIG5ldyBFdmVudCgidXBkYXRlIiksIG5ldyBBYm9ydENvbnRyb2xsZXIoKS5zaWduYWwpOwogICAgICB9IGNhdGNoIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0b2tlbiAhPT0gY3VycmVudCkgcmV0dXJuOwogICAgICBzZXRDb21wdXRlZEF0dHIoZWwsIHNwZWMubiwgcmVzdWx0KTsKCiAgICAgIGNvbGxlY3RSZWZzKHNjb3BlLCAocmVmKSA9PiB7CiAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSBzdG9yZS53YXRjaChyZWYuaWQsICgpID0+IHsKICAgICAgICAgIHZvaWQgcnVuKCk7CiAgICAgICAgfSk7CiAgICAgICAgdW5zdWJzLmFkZCh1bnN1YnNjcmliZSk7CiAgICAgIH0pOwogICAgfTsKCiAgICB2b2lkIHJ1bigpOwoKICAgIGN0eC5hdHRyQ2xlYW51cHMuc2V0KGtleSwgKCkgPT4gewogICAgICB1bnN1YnMuZm9yRWFjaCgoZGlzcG9zZSkgPT4gZGlzcG9zZSgpKTsKICAgICAgdW5zdWJzLmNsZWFyKCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGh5ZHJhdGVQYXlsb2FkKGVsOiBFbGVtZW50LCBwYXlsb2FkOiBIeWRyYXRpb25QYXlsb2FkKTogdm9pZCB7CiAgICBpZiAoIXBheWxvYWQgfHwgdHlwZW9mIHBheWxvYWQgIT09ICJvYmplY3QiKSByZXR1cm47CiAgICBjb25zdCBjdHggPSBnZXRDb250ZXh0KGVsKTsKCiAgICBpZiAoImJpbmQiIGluIHBheWxvYWQpIHsKICAgICAgY3R4LmJpbmQgPSBwYXlsb2FkLmJpbmQ7CiAgICB9CgogICAgcGF5bG9hZC5vbj8uZm9yRWFjaCgoZW50cnkpID0+IGF0dGFjaEhhbmRsZXIoZWwsIGVudHJ5KSk7CiAgICBwYXlsb2FkLmF0dHJzPy5mb3JFYWNoKChhdHRyKSA9PiBiaW5kQ29tcHV0ZWRBdHRyKGVsLCBhdHRyKSk7CiAgfQoKICBmdW5jdGlvbiBmaW5kSHlkcmF0aW9uRWxlbWVudChzY3JpcHQ6IEhUTUxTY3JpcHRFbGVtZW50KTogRWxlbWVudCB8IG51bGwgewogICAgY29uc3QgaWQgPSBzY3JpcHQuZ2V0QXR0cmlidXRlKCJkYXRhLWh5ZHJhdGUiKSA/PyAiIjsKICAgIGlmICghaWQpIHJldHVybiBudWxsOwoKICAgIGxldCBub2RlOiBDaGlsZE5vZGUgfCBudWxsID0gc2NyaXB0LnByZXZpb3VzU2libGluZzsKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICAgIHJldHVybiBub2RlIGFzIEVsZW1lbnQ7CiAgICAgIH0KICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuQ09NTUVOVF9OT0RFKSB7CiAgICAgICAgY29uc3QgY29tbWVudCA9IG5vZGUgYXMgQ29tbWVudDsKICAgICAgICBpZiAoY29tbWVudC5kYXRhID09PSBgL3J3Omg6JHtpZH1gIHx8IGNvbW1lbnQuZGF0YSA9PT0gYC9oeWRyYXRpb24tYm91bmRhcnk6JHtpZH1gKSB7CiAgICAgICAgICBsZXQgcHJldjogQ2hpbGROb2RlIHwgbnVsbCA9IGNvbW1lbnQucHJldmlvdXNTaWJsaW5nOwogICAgICAgICAgd2hpbGUgKHByZXYgJiYgcHJldi5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgcHJldiA9IHByZXYucHJldmlvdXNTaWJsaW5nOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHByZXYgJiYgcHJldi5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgcmV0dXJuIHByZXYgYXMgRWxlbWVudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNvbW1lbnQuZGF0YSA9PT0gYGh5ZHJhdGlvbi1ib3VuZGFyeToke2lkfWApIHsKICAgICAgICAgIGxldCBuZXh0OiBDaGlsZE5vZGUgfCBudWxsID0gY29tbWVudC5uZXh0U2libGluZzsKICAgICAgICAgIHdoaWxlIChuZXh0ICYmIG5leHQubm9kZVR5cGUgIT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICAgICAgICAgIG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5leHQgJiYgbmV4dC5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgcmV0dXJuIG5leHQgYXMgRWxlbWVudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgbm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiBoeWRyYXRlU2NyaXB0KHNjcmlwdDogSFRNTFNjcmlwdEVsZW1lbnQpOiB2b2lkIHsKICAgIGNvbnN0IGlkID0gc2NyaXB0LmdldEF0dHJpYnV0ZSgiZGF0YS1oeWRyYXRlIikgPz8gIiI7CiAgICBpZiAoIWlkIHx8IGh5ZHJhdGVkLmhhcyhpZCkpIHJldHVybjsKCiAgICBjb25zdCBlbCA9IGZpbmRIeWRyYXRpb25FbGVtZW50KHNjcmlwdCk7CiAgICBpZiAoIWVsKSByZXR1cm47CgogICAgY29uc3QgcGF5bG9hZCA9IHBhcnNlUGF5bG9hZChzY3JpcHQudGV4dENvbnRlbnQgPz8gInt9Iik7CiAgICBoeWRyYXRlUGF5bG9hZChlbCwgcGF5bG9hZCk7CiAgICBoeWRyYXRlZC5hZGQoaWQpOwogIH0KCiAgZnVuY3Rpb24gdGVhcmRvd25FbGVtZW50KGVsOiBFbGVtZW50KTogdm9pZCB7CiAgICBjb25zdCBjdHggPSBjb250ZXh0cy5nZXQoZWwpOwogICAgaWYgKCFjdHgpIHJldHVybjsKCiAgICBjdHguY29udHJvbGxlcnMuZm9yRWFjaCgoY3RybCkgPT4gY3RybC5hYm9ydCgpKTsKICAgIGN0eC5jb250cm9sbGVycy5jbGVhcigpOwoKICAgIGlmIChjdHgudW5tb3VudC5sZW5ndGgpIHsKICAgICAgY3R4LnVubW91bnQuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgICAgICB2b2lkIGludm9rZUVudHJ5KGVsLCBlbnRyeSwgInVubW91bnQiLCBuZXcgRXZlbnQoInVubW91bnQiKSk7CiAgICAgIH0pOwogICAgICBjdHgudW5tb3VudC5sZW5ndGggPSAwOwogICAgfQoKICAgIGN0eC5hdHRyQ2xlYW51cHMuZm9yRWFjaCgoZGlzcG9zZSkgPT4gZGlzcG9zZSgpKTsKICAgIGN0eC5hdHRyQ2xlYW51cHMuY2xlYXIoKTsKCiAgICBjb250ZXh0cy5kZWxldGUoZWwpOwogIH0KCiAgY29uc3QgaXNIeWRyYXRpb25TY3JpcHQgPSAobm9kZTogTm9kZSk6IG5vZGUgaXMgSFRNTFNjcmlwdEVsZW1lbnQgPT4KICAgIG5vZGUgaW5zdGFuY2VvZiBIVE1MU2NyaXB0RWxlbWVudCAmJgogICAgKG5vZGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikgfHwgIiIpLnRvTG93ZXJDYXNlKCkgPT09ICJhcHBsaWNhdGlvbi9qc29uIiAmJgogICAgbm9kZS5oYXNBdHRyaWJ1dGUoImRhdGEtaHlkcmF0ZSIpOwoKICBmdW5jdGlvbiBzZWVkKCk6IHZvaWQgewogICAgZG9jdW1lbnQKICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdFt0eXBlPSJhcHBsaWNhdGlvbi9qc29uIl1bZGF0YS1oeWRyYXRlXScpCiAgICAgIC5mb3JFYWNoKChub2RlKSA9PiBoeWRyYXRlU2NyaXB0KG5vZGUgYXMgSFRNTFNjcmlwdEVsZW1lbnQpKTsKICB9CgogIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9ucykgPT4gewogICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHsKICAgICAgbXV0YXRpb24uYWRkZWROb2Rlcz8uZm9yRWFjaCgobm9kZSkgPT4gewogICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBFbGVtZW50KSkgcmV0dXJuOwogICAgICAgIGlmIChpc0h5ZHJhdGlvblNjcmlwdChub2RlKSkgewogICAgICAgICAgaHlkcmF0ZVNjcmlwdChub2RlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbm9kZQogICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdFt0eXBlPSJhcHBsaWNhdGlvbi9qc29uIl1bZGF0YS1oeWRyYXRlXScpCiAgICAgICAgICAuZm9yRWFjaCgoc2NyaXB0KSA9PiBoeWRyYXRlU2NyaXB0KHNjcmlwdCBhcyBIVE1MU2NyaXB0RWxlbWVudCkpOwogICAgICB9KTsKCiAgICAgIG11dGF0aW9uLnJlbW92ZWROb2Rlcz8uZm9yRWFjaCgobm9kZSkgPT4gewogICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBFbGVtZW50KSkgcmV0dXJuOwogICAgICAgIHRlYXJkb3duRWxlbWVudChub2RlKTsKICAgICAgICBub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKS5mb3JFYWNoKChjaGlsZCkgPT4gewogICAgICAgICAgdGVhcmRvd25FbGVtZW50KGNoaWxkKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIHNlZWQoKTsKICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTsKCiAgZ2xvYmFsV2luZG93Ll9fcnV3dXRlciA9IE9iamVjdC5hc3NpZ24oZ2xvYmFsV2luZG93Ll9fcnV3dXRlciA/PyB7fSwgewogICAgc3RvcmUsCiAgfSk7Cn0KCmlmIChoYXNXaW5kb3cpIHsKICBpbml0aWFsaXplQ2xpZW50UnVudGltZSgpOwp9CgpleHBvcnQge307Cg==" as const;

let instance = 0;

export const nextClientRuntimeUrl = () =>
  `data:application/typescript;base64,${CLIENT_RUNTIME_BASE64}#${instance++}`;
