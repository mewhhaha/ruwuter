// Generated from src/runtime/client.ts using
//   base64 -w0 src/runtime/client.ts
// Update alongside runtime changes to keep DOM tests in sync.

const CLIENT_RUNTIME_BASE64 =
  "dHlwZSBSZWZMaXN0ZW5lciA9ICgpID0+IHZvaWQ7Cgp0eXBlIEV2ZW50TGlzdGVuZXJPcHRpb25zID0gewogIGNhcHR1cmU/OiBib29sZWFuOwogIG9uY2U/OiBib29sZWFuOwogIHBhc3NpdmU/OiBib29sZWFuOwogIHByZXZlbnREZWZhdWx0PzogYm9vbGVhbjsKfTsKCnR5cGUgTW9kdWxlRW50cnkgPSB7CiAgdDogIm0iOwogIHM6IHN0cmluZzsKICB4Pzogc3RyaW5nOwogIGV2Pzogc3RyaW5nOwogIG9wdD86IEV2ZW50TGlzdGVuZXJPcHRpb25zOwp9OwoKdHlwZSBIeWRyYXRpb25QYXlsb2FkID0gewogIGJpbmQ/OiB1bmtub3duOwogIG9uPzogTW9kdWxlRW50cnlbXTsKICByZWY/OiBSZWZPYmplY3Q7Cn07Cgp0eXBlIENsaWVudEZuID0gKHRoaXM6IHVua25vd24sIGV2OiBFdmVudCwgc2lnbmFsOiBBYm9ydFNpZ25hbCkgPT4gdW5rbm93bjsKCmludGVyZmFjZSBSZWZPYmplY3QgewogIGlkOiBzdHJpbmc7CiAgZ2V0KCk6IHVua25vd247CiAgc2V0KG5leHQ6IHVua25vd24gfCAoKHByZXY6IHVua25vd24pID0+IHVua25vd24pKTogdm9pZDsKICB0b0pTT04oKTogeyBfX3JlZjogdHJ1ZTsgaTogc3RyaW5nOyB2OiB1bmtub3duIH07CiAgdG9TdHJpbmcoKTogc3RyaW5nOwp9CgppbnRlcmZhY2UgUmVmU3RvcmUgewogIHNldChpZDogc3RyaW5nLCBuZXh0OiB1bmtub3duIHwgKChwcmV2OiB1bmtub3duKSA9PiB1bmtub3duKSk6IHZvaWQ7CiAgZ2V0KGlkOiBzdHJpbmcpOiB1bmtub3duOwogIHdhdGNoKGlkOiBzdHJpbmcsIGZuOiBSZWZMaXN0ZW5lcik6ICgpID0+IHZvaWQ7CiAgcmVmKGlkOiBzdHJpbmcsIGluaXRpYWw6IHVua25vd24pOiBSZWZPYmplY3Q7Cn0KCmludGVyZmFjZSBFbGVtZW50Q29udGV4dCB7CiAgYmluZDogdW5rbm93bjsKICBjb250cm9sbGVyczogTWFwPHN0cmluZywgQWJvcnRDb250cm9sbGVyPjsKICB1bm1vdW50OiBNb2R1bGVFbnRyeVtdOwogIHJlZnM6IFJlZk9iamVjdFtdOwp9Cgp0eXBlIE1vZHVsZU5hbWVzcGFjZSA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+OwoKaW50ZXJmYWNlIEdsb2JhbENsaWVudFdpbmRvdyBleHRlbmRzIFdpbmRvdyB7CiAgX19ydXd1dGVyPzogewogICAgc3RvcmU/OiBSZWZTdG9yZTsKICAgIGxvYWRNb2R1bGU/OiAoc3BlYzogc3RyaW5nKSA9PiBQcm9taXNlPE1vZHVsZU5hbWVzcGFjZT47CiAgfTsKfQoKaW50ZXJmYWNlIFN5bnRoZXRpY0V2ZW50SW5pdCB7CiAgY3VycmVudFRhcmdldD86IEV2ZW50VGFyZ2V0IHwgbnVsbDsKfQoKY29uc3Qgc3ludGhldGljRXZlbnRDYWNoZSA9IG5ldyBXZWFrTWFwPEV2ZW50LCBFdmVudD4oKTsKCmZ1bmN0aW9uIHN5bnRoZXNpemVFdmVudDxFIGV4dGVuZHMgRXZlbnQ+KAogIGV2ZW50OiBFLAogIGluaXQ/OiBTeW50aGV0aWNFdmVudEluaXQsCikgewogIGlmICghaW5pdCAmJiBzeW50aGV0aWNFdmVudENhY2hlLmhhcyhldmVudCkpIHsKICAgIHJldHVybiBzeW50aGV0aWNFdmVudENhY2hlLmdldChldmVudCkhIGFzIEU7CiAgfQoKICBjb25zdCBjdXJyZW50VGFyZ2V0ID0gaW5pdD8uY3VycmVudFRhcmdldCA/PyBldmVudC5jdXJyZW50VGFyZ2V0ID8/IG51bGw7CiAgY29uc3Qgc3JjRWxlbWVudCA9CiAgICAoInNyY0VsZW1lbnQiIGluIGV2ZW50CiAgICAgID8gKGV2ZW50IGFzIEV2ZW50ICYgeyBzcmNFbGVtZW50PzogRXZlbnRUYXJnZXQgfCBudWxsIH0pLnNyY0VsZW1lbnQKICAgICAgOiB1bmRlZmluZWQpID8/CiAgICAgIGN1cnJlbnRUYXJnZXQ7CiAgY29uc3QgZXZlbnRQaGFzZSA9IGV2ZW50LmV2ZW50UGhhc2U7CiAgY29uc3QgaGFzUmVsYXRlZFRhcmdldCA9ICJyZWxhdGVkVGFyZ2V0IiBpbiBldmVudDsKICBjb25zdCByZWxhdGVkVGFyZ2V0ID0gaGFzUmVsYXRlZFRhcmdldAogICAgPyAoZXZlbnQgYXMgRXZlbnQgJiB7IHJlbGF0ZWRUYXJnZXQ/OiBFdmVudFRhcmdldCB8IG51bGwgfSkucmVsYXRlZFRhcmdldAogICAgOiB1bmRlZmluZWQ7CiAgY29uc3QgY29tcG9zZWRQYXRoID0gdHlwZW9mIGV2ZW50LmNvbXBvc2VkUGF0aCA9PT0gImZ1bmN0aW9uIiA/IGV2ZW50LmNvbXBvc2VkUGF0aCgpIDogdW5kZWZpbmVkOwogIGNvbnN0IHRvZ2dsZUNhbmRpZGF0ZSA9IGV2ZW50IGFzIEV2ZW50ICYgewogICAgbmV3U3RhdGU/OiBzdHJpbmc7CiAgICBvbGRTdGF0ZT86IHN0cmluZzsKICAgIHNvdXJjZT86IEVsZW1lbnQgfCBudWxsOwogIH07CiAgY29uc3QgaGFzVG9nZ2xlU3RhdGUgPSB0eXBlb2YgdG9nZ2xlQ2FuZGlkYXRlLm5ld1N0YXRlID09PSAic3RyaW5nIiB8fAogICAgdHlwZW9mIHRvZ2dsZUNhbmRpZGF0ZS5vbGRTdGF0ZSA9PT0gInN0cmluZyI7CiAgY29uc3QgdG9nZ2xlTmV3U3RhdGUgPSBoYXNUb2dnbGVTdGF0ZSA/IHRvZ2dsZUNhbmRpZGF0ZS5uZXdTdGF0ZSA6IHVuZGVmaW5lZDsKICBjb25zdCB0b2dnbGVPbGRTdGF0ZSA9IGhhc1RvZ2dsZVN0YXRlID8gdG9nZ2xlQ2FuZGlkYXRlLm9sZFN0YXRlIDogdW5kZWZpbmVkOwogIGNvbnN0IHRvZ2dsZVNvdXJjZSA9IGhhc1RvZ2dsZVN0YXRlID8gdG9nZ2xlQ2FuZGlkYXRlLnNvdXJjZSA/PyBudWxsIDogdW5kZWZpbmVkOwoKICBjb25zdCBoYXNTdWJtaXR0ZXIgPSAic3VibWl0dGVyIiBpbiBldmVudDsKICBjb25zdCBzdWJtaXR0ZXIgPSBoYXNTdWJtaXR0ZXIKICAgID8gKGV2ZW50IGFzIEV2ZW50ICYgeyBzdWJtaXR0ZXI/OiBFbGVtZW50IHwgbnVsbCB9KS5zdWJtaXR0ZXIgPz8gbnVsbAogICAgOiB1bmRlZmluZWQ7CgogIGNvbnN0IHByb3h5ID0gbmV3IFByb3h5KGV2ZW50LCB7CiAgICBnZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikgewogICAgICBpZiAocHJvcCA9PT0gImN1cnJlbnRUYXJnZXQiKSByZXR1cm4gY3VycmVudFRhcmdldDsKICAgICAgaWYgKHByb3AgPT09ICJzcmNFbGVtZW50IikgcmV0dXJuIHNyY0VsZW1lbnQ7CiAgICAgIGlmIChwcm9wID09PSAiZXZlbnRQaGFzZSIpIHJldHVybiBldmVudFBoYXNlOwogICAgICBpZiAocHJvcCA9PT0gInJlbGF0ZWRUYXJnZXQiICYmIGhhc1JlbGF0ZWRUYXJnZXQpIHJldHVybiByZWxhdGVkVGFyZ2V0OwogICAgICBpZiAocHJvcCA9PT0gInN1Ym1pdHRlciIgJiYgaGFzU3VibWl0dGVyKSByZXR1cm4gc3VibWl0dGVyOwogICAgICBpZiAocHJvcCA9PT0gImNvbXBvc2VkUGF0aCIpIHsKICAgICAgICByZXR1cm4gKCkgPT4gY29tcG9zZWRQYXRoID8gY29tcG9zZWRQYXRoLnNsaWNlKCkgOiBbXTsKICAgICAgfQogICAgICBpZiAoaGFzVG9nZ2xlU3RhdGUpIHsKICAgICAgICBpZiAocHJvcCA9PT0gIm5ld1N0YXRlIikgcmV0dXJuIHRvZ2dsZU5ld1N0YXRlOwogICAgICAgIGlmIChwcm9wID09PSAib2xkU3RhdGUiKSByZXR1cm4gdG9nZ2xlT2xkU3RhdGU7CiAgICAgICAgaWYgKHByb3AgPT09ICJzb3VyY2UiKSByZXR1cm4gdG9nZ2xlU291cmNlOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0gUmVmbGVjdC5nZXQodGFyZ2V0LCBwcm9wKTsKICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIiA/IHZhbHVlLmJpbmQodGFyZ2V0KSA6IHZhbHVlOwogICAgfSwKICB9KTsKCiAgaWYgKCFpbml0KSB7CiAgICBzeW50aGV0aWNFdmVudENhY2hlLnNldChldmVudCwgcHJveHkpOwogIH0KICByZXR1cm4gcHJveHkgYXMgRTsKfQoKY29uc3QgaGFzV2luZG93ID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCI7CgpmdW5jdGlvbiBpbml0aWFsaXplQ2xpZW50UnVudGltZSgpOiB2b2lkIHsKICBpZiAoIWhhc1dpbmRvdykgcmV0dXJuOwogIGNvbnN0IGdsb2JhbFdpbmRvdyA9IHdpbmRvdyBhcyBHbG9iYWxDbGllbnRXaW5kb3c7CiAgaWYgKGdsb2JhbFdpbmRvdy5fX3J1d3V0ZXI/LnN0b3JlKSByZXR1cm47CiAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gInVuZGVmaW5lZCIpIHJldHVybjsKCiAgY29uc3QgbG9hZE1vZHVsZSA9ICgoKSA9PiB7CiAgICBjb25zdCBjYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBQcm9taXNlPE1vZHVsZU5hbWVzcGFjZT4+KCk7CgogICAgY29uc3QgcmVzb2x2ZSA9IChzcGVjOiBzdHJpbmcpID0+IHsKICAgICAgaWYgKC9eW2EtekEtWl1bYS16QS1aMC05Ky4tXSo6Ly50ZXN0KHNwZWMpKSByZXR1cm4gc3BlYzsgLy8gYWxyZWFkeSBhYnNvbHV0ZSBVUkwKICAgICAgaWYgKHNwZWMuc3RhcnRzV2l0aCgiLyIpKSByZXR1cm4gbmV3IFVSTChzcGVjLCB3aW5kb3cubG9jYXRpb24ub3JpZ2luKS5ocmVmOwogICAgICAvLyBSZXNvbHZlIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IGRpcmVjdG9yeSwgbm90IHRyZWF0aW5nIHRoZSBsYXN0IHBhdGggc2VnbWVudCBhcyBhIGZpbGUKICAgICAgY29uc3QgYmFzZURpciA9IG5ldyBVUkwoIi4iLCB3aW5kb3cubG9jYXRpb24uaHJlZik7CiAgICAgIHJldHVybiBuZXcgVVJMKHNwZWMsIGJhc2VEaXIpLmhyZWY7CiAgICB9OwoKICAgIHJldHVybiAoc3BlYzogc3RyaW5nKSA9PiB7CiAgICAgIGNvbnN0IHJlc29sdmVkID0gcmVzb2x2ZShzcGVjKTsKICAgICAgaWYgKCFjYWNoZS5oYXMocmVzb2x2ZWQpKSB7CiAgICAgICAgY29uc3QgY3VzdG9tTG9hZGVyID0gZ2xvYmFsV2luZG93Ll9fcnV3dXRlcj8ubG9hZE1vZHVsZTsKICAgICAgICBjYWNoZS5zZXQoCiAgICAgICAgICByZXNvbHZlZCwKICAgICAgICAgIGN1c3RvbUxvYWRlciA/IGN1c3RvbUxvYWRlcihyZXNvbHZlZCkgOiBpbXBvcnQocmVzb2x2ZWQpLAogICAgICAgICk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNhY2hlLmdldChyZXNvbHZlZCkhOwogICAgfTsKICB9KSgpOwoKICBjb25zdCBzdG9yZTogUmVmU3RvcmUgPSAoKCkgPT4gewogICAgY29uc3QgdmFsdWVzID0gbmV3IE1hcDxzdHJpbmcsIHVua25vd24+KCk7CiAgICBjb25zdCBsaXN0ZW5lcnMgPSBuZXcgTWFwPHN0cmluZywgU2V0PFJlZkxpc3RlbmVyPj4oKTsKICAgIGNvbnN0IHJlZnMgPSBuZXcgTWFwPHN0cmluZywgUmVmT2JqZWN0PigpOwoKICAgIGNvbnN0IGVuc3VyZSA9IChpZDogc3RyaW5nLCBpbml0aWFsOiB1bmtub3duKSA9PiB7CiAgICAgIGlmICghdmFsdWVzLmhhcyhpZCkpIHZhbHVlcy5zZXQoaWQsIGluaXRpYWwpOwogICAgICByZXR1cm4gdmFsdWVzLmdldChpZCk7CiAgICB9OwoKICAgIGNvbnN0IHNldCA9IChpZDogc3RyaW5nLCBuZXh0OiB1bmtub3duIHwgKChwcmV2OiB1bmtub3duKSA9PiB1bmtub3duKSkgPT4gewogICAgICBjb25zdCBjdXJyZW50ID0gdmFsdWVzLmdldChpZCk7CiAgICAgIGNvbnN0IHZhbHVlID0gdHlwZW9mIG5leHQgPT09ICJmdW5jdGlvbiIKICAgICAgICA/IChuZXh0IGFzIChwcmV2OiB1bmtub3duKSA9PiB1bmtub3duKShjdXJyZW50KQogICAgICAgIDogbmV4dDsKICAgICAgdmFsdWVzLnNldChpZCwgdmFsdWUpOwogICAgICBjb25zdCBzdWJzID0gbGlzdGVuZXJzLmdldChpZCk7CiAgICAgIGlmICghc3VicykgcmV0dXJuOwogICAgICBjb25zdCBzbmFwc2hvdCA9IEFycmF5LmZyb20oc3Vicyk7CiAgICAgIHNuYXBzaG90LmZvckVhY2goKGZuKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZuKCk7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAvKiBpZ25vcmUgc3Vic2NyaWJlciBlcnJvcnMgKi8KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICBjb25zdCB3YXRjaCA9IChpZDogc3RyaW5nLCBmbjogUmVmTGlzdGVuZXIpID0+IHsKICAgICAgbGV0IHN1YnMgPSBsaXN0ZW5lcnMuZ2V0KGlkKTsKICAgICAgaWYgKCFzdWJzKSB7CiAgICAgICAgc3VicyA9IG5ldyBTZXQ8UmVmTGlzdGVuZXI+KCk7CiAgICAgICAgbGlzdGVuZXJzLnNldChpZCwgc3Vicyk7CiAgICAgIH0KICAgICAgc3Vicy5hZGQoZm4pOwogICAgICByZXR1cm4gKCkgPT4gewogICAgICAgIGNvbnN0IGJ1Y2tldCA9IGxpc3RlbmVycy5nZXQoaWQpOwogICAgICAgIGlmICghYnVja2V0KSByZXR1cm47CiAgICAgICAgYnVja2V0LmRlbGV0ZShmbik7CiAgICAgICAgaWYgKGJ1Y2tldC5zaXplID09PSAwKSBsaXN0ZW5lcnMuZGVsZXRlKGlkKTsKICAgICAgfTsKICAgIH07CgogICAgY29uc3QgY3JlYXRlUmVmID0gKGlkOiBzdHJpbmcsIGluaXRpYWw6IHVua25vd24pOiBSZWZPYmplY3QgPT4gewogICAgICBlbnN1cmUoaWQsIGluaXRpYWwpOwogICAgICBpZiAoIXJlZnMuaGFzKGlkKSkgewogICAgICAgIGNvbnN0IHJlZjogUmVmT2JqZWN0ID0gewogICAgICAgICAgaWQsCiAgICAgICAgICBnZXQ6ICgpID0+IHZhbHVlcy5nZXQoaWQpLAogICAgICAgICAgc2V0OiAobmV4dCkgPT4gc2V0KGlkLCBuZXh0KSwKICAgICAgICAgIHRvSlNPTjogKCkgPT4gKHsgX19yZWY6IHRydWUgYXMgY29uc3QsIGk6IGlkLCB2OiB2YWx1ZXMuZ2V0KGlkKSB9KSwKICAgICAgICAgIHRvU3RyaW5nOiAoKSA9PiBTdHJpbmcodmFsdWVzLmdldChpZCkpLAogICAgICAgIH07CiAgICAgICAgcmVmcy5zZXQoaWQsIHJlZik7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlZnMuZ2V0KGlkKSE7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgIHNldCwKICAgICAgZ2V0OiAoaWQ6IHN0cmluZykgPT4gdmFsdWVzLmdldChpZCksCiAgICAgIHdhdGNoLAogICAgICByZWY6IGNyZWF0ZVJlZiwKICAgIH07CiAgfSkoKTsKCiAgY29uc3QgY29udGV4dHMgPSBuZXcgV2Vha01hcDxFbGVtZW50LCBFbGVtZW50Q29udGV4dD4oKTsKICBjb25zdCBoeWRyYXRlZCA9IG5ldyBTZXQ8c3RyaW5nPigpOwoKICBmdW5jdGlvbiByZXZpdmUoX2tleTogc3RyaW5nLCB2YWx1ZTogdW5rbm93bik6IHVua25vd24gewogICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIpIHsKICAgICAgY29uc3QgcmVjb3JkID0gdmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47CiAgICAgIGlmIChyZWNvcmQuX19yZWYgPT09IHRydWUgJiYgdHlwZW9mIHJlY29yZC5pID09PSAic3RyaW5nIikgewogICAgICAgIGNvbnN0IGlkID0gcmVjb3JkLmk7CiAgICAgICAgY29uc3QgaW5pdGlhbCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZWNvcmQsICJ2IikgPyByZWNvcmQudiA6IHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gc3RvcmUucmVmKGlkLCBpbml0aWFsKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHZhbHVlOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VQYXlsb2FkKHRleHQ6IHN0cmluZyk6IEh5ZHJhdGlvblBheWxvYWQgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIChKU09OLnBhcnNlKHRleHQsIHJldml2ZSkgYXMgSHlkcmF0aW9uUGF5bG9hZCkgPz8ge307CiAgICB9IGNhdGNoIHsKICAgICAgcmV0dXJuIHt9OwogICAgfQogIH0KCiAgYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZUVudHJ5KGVudHJ5PzogTW9kdWxlRW50cnkpOiBQcm9taXNlPENsaWVudEZuIHwgdW5kZWZpbmVkPiB7CiAgICBpZiAoIWVudHJ5IHx8IGVudHJ5LnQgIT09ICJtIikgcmV0dXJuIHVuZGVmaW5lZDsKICAgIGNvbnN0IG1vZCA9IGF3YWl0IGxvYWRNb2R1bGUoZW50cnkucyk7CiAgICBjb25zdCBjYW5kaWRhdGUgPSBlbnRyeS54ICYmIGVudHJ5LnggaW4gbW9kICYmIHR5cGVvZiBtb2RbZW50cnkueF0gPT09ICJmdW5jdGlvbiIKICAgICAgPyAobW9kW2VudHJ5LnhdIGFzIENsaWVudEZuKQogICAgICA6IHR5cGVvZiBtb2QuZGVmYXVsdCA9PT0gImZ1bmN0aW9uIgogICAgICA/IChtb2QuZGVmYXVsdCBhcyBDbGllbnRGbikKICAgICAgOiB0eXBlb2YgbW9kID09PSAiZnVuY3Rpb24iCiAgICAgID8gKG1vZCBhcyB1bmtub3duIGFzIENsaWVudEZuKQogICAgICA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBjYW5kaWRhdGU7CiAgfQoKICBmdW5jdGlvbiBnZXRDb250ZXh0KGVsOiBFbGVtZW50KTogRWxlbWVudENvbnRleHQgewogICAgbGV0IGN0eCA9IGNvbnRleHRzLmdldChlbCk7CiAgICBpZiAoIWN0eCkgewogICAgICBjdHggPSB7CiAgICAgICAgYmluZDogdW5kZWZpbmVkLAogICAgICAgIGNvbnRyb2xsZXJzOiBuZXcgTWFwPHN0cmluZywgQWJvcnRDb250cm9sbGVyPigpLAogICAgICAgIHVubW91bnQ6IFtdLAogICAgICAgIHJlZnM6IFtdLAogICAgICB9OwogICAgICBjb250ZXh0cy5zZXQoZWwsIGN0eCk7CiAgICB9CiAgICByZXR1cm4gY3R4OwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gaW52b2tlRW50cnkoCiAgICBlbDogRWxlbWVudCwKICAgIGVudHJ5OiBNb2R1bGVFbnRyeSwKICAgIHR5cGU6IHN0cmluZywKICAgIGV2OiBFdmVudCwKICApOiBQcm9taXNlPHZvaWQ+IHsKICAgIGNvbnN0IGZuID0gYXdhaXQgcmVzb2x2ZUVudHJ5KGVudHJ5KTsKICAgIGlmICghZm4pIHJldHVybjsKICAgIGNvbnN0IGN0eCA9IGdldENvbnRleHQoZWwpOwogICAgY29uc3QgY29udHJvbGxlcnMgPSBjdHguY29udHJvbGxlcnM7CgogICAgaWYgKHR5cGUgPT09ICJ1bm1vdW50IikgewogICAgICBjb250cm9sbGVycy5mb3JFYWNoKChjdHJsKSA9PiBjdHJsLmFib3J0KCkpOwogICAgICBjb250cm9sbGVycy5jbGVhcigpOwogICAgfQoKICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBpZiAodHlwZSkgewogICAgICBjb250cm9sbGVycy5nZXQodHlwZSk/LmFib3J0KCk7CiAgICAgIGNvbnRyb2xsZXJzLnNldCh0eXBlLCBjb250cm9sbGVyKTsKICAgIH0KCiAgICBjb25zdCBldmVudEZvckhhbmRsZXIgPSB0eXBlID09PSAibW91bnQiIHx8IHR5cGUgPT09ICJ1bm1vdW50IgogICAgICA/IHN5bnRoZXNpemVFdmVudChldiwgeyBjdXJyZW50VGFyZ2V0OiBlbCB9KQogICAgICA6IGV2OwoKICAgIHRyeSB7CiAgICAgIGF3YWl0IGZuLmNhbGwoY3R4LmJpbmQgPz8gZWwsIGV2ZW50Rm9ySGFuZGxlciwgY29udHJvbGxlci5zaWduYWwpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGlmICgKICAgICAgICBjb250cm9sbGVyLnNpZ25hbC5hYm9ydGVkIHx8CiAgICAgICAgKGVyciBpbnN0YW5jZW9mIEVycm9yICYmIGVyci5uYW1lID09PSAiQWJvcnRFcnJvciIpCiAgICAgICkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAodHlwZSAmJiBjb250cm9sbGVycy5nZXQodHlwZSkgPT09IGNvbnRyb2xsZXIpIHsKICAgICAgICBjb250cm9sbGVycy5kZWxldGUodHlwZSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGF0dGFjaEhhbmRsZXIoZWw6IEVsZW1lbnQsIGVudHJ5OiBNb2R1bGVFbnRyeSk6IHZvaWQgewogICAgaWYgKCFlbnRyeSB8fCBlbnRyeS50ICE9PSAibSIpIHJldHVybjsKICAgIGNvbnN0IHR5cGUgPSBlbnRyeS5ldiAmJiBlbnRyeS5ldi5sZW5ndGggPiAwID8gZW50cnkuZXYgOiAiY2xpY2siOwoKICAgIGlmICh0eXBlID09PSAibW91bnQiKSB7CiAgICAgIHF1ZXVlTWljcm90YXNrKCgpID0+IGludm9rZUVudHJ5KGVsLCBlbnRyeSwgIm1vdW50IiwgbmV3IEV2ZW50KCJtb3VudCIpKSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBjdHggPSBnZXRDb250ZXh0KGVsKTsKICAgIGlmICh0eXBlID09PSAidW5tb3VudCIpIHsKICAgICAgY3R4LnVubW91bnQucHVzaChlbnRyeSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGxpc3RlbmVyT3B0aW9ucyA9IGVudHJ5Lm9wdAogICAgICA/IHsKICAgICAgICBjYXB0dXJlOiBlbnRyeS5vcHQuY2FwdHVyZSwKICAgICAgICBvbmNlOiBlbnRyeS5vcHQub25jZSwKICAgICAgICBwYXNzaXZlOiBlbnRyeS5vcHQucGFzc2l2ZSwKICAgICAgfQogICAgICA6IHVuZGVmaW5lZDsKICAgIGNvbnN0IHByZXZlbnREZWZhdWx0ID0gZW50cnkub3B0Py5wcmV2ZW50RGVmYXVsdCA9PT0gdHJ1ZSAmJiBlbnRyeS5vcHQucGFzc2l2ZSAhPT0gdHJ1ZTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2ZW50KSA9PiB7CiAgICAgIGlmIChwcmV2ZW50RGVmYXVsdCAmJiBldmVudC5jYW5jZWxhYmxlKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgICBjb25zdCBzeW50aGV0aWMgPSBzeW50aGVzaXplRXZlbnQoZXZlbnQpOwogICAgICB2b2lkIGludm9rZUVudHJ5KGVsLCBlbnRyeSwgdHlwZSwgc3ludGhldGljKTsKICAgIH0sIGxpc3RlbmVyT3B0aW9ucyk7CiAgfQoKICBmdW5jdGlvbiBoeWRyYXRlUGF5bG9hZChlbDogRWxlbWVudCwgcGF5bG9hZDogSHlkcmF0aW9uUGF5bG9hZCk6IHZvaWQgewogICAgaWYgKCFwYXlsb2FkIHx8IHR5cGVvZiBwYXlsb2FkICE9PSAib2JqZWN0IikgcmV0dXJuOwogICAgY29uc3QgY3R4ID0gZ2V0Q29udGV4dChlbCk7CgogICAgaWYgKCJiaW5kIiBpbiBwYXlsb2FkKSB7CiAgICAgIGN0eC5iaW5kID0gcGF5bG9hZC5iaW5kOwogICAgfQoKICAgIGlmIChwYXlsb2FkLnJlZikgewogICAgICBjb25zdCByZWZzID0gY3R4LnJlZnM7CiAgICAgIGlmICghcmVmcy5pbmNsdWRlcyhwYXlsb2FkLnJlZikpIHsKICAgICAgICByZWZzLnB1c2gocGF5bG9hZC5yZWYpOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgcGF5bG9hZC5yZWYuc2V0KGVsKTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgLyogaWdub3JlIHJlZiBhc3NpZ25tZW50IGVycm9ycyAqLwogICAgICB9CiAgICB9CgogICAgcGF5bG9hZC5vbj8uZm9yRWFjaCgoZW50cnkpID0+IGF0dGFjaEhhbmRsZXIoZWwsIGVudHJ5KSk7CiAgfQoKICBmdW5jdGlvbiBmaW5kSHlkcmF0aW9uRWxlbWVudChzY3JpcHQ6IEhUTUxTY3JpcHRFbGVtZW50KTogRWxlbWVudCB8IG51bGwgewogICAgY29uc3QgaWQgPSBzY3JpcHQuZ2V0QXR0cmlidXRlKCJkYXRhLWh5ZHJhdGUiKSA/PyAiIjsKICAgIGlmICghaWQpIHJldHVybiBudWxsOwoKICAgIGxldCBub2RlOiBDaGlsZE5vZGUgfCBudWxsID0gc2NyaXB0LnByZXZpb3VzU2libGluZzsKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICAgIHJldHVybiBub2RlIGFzIEVsZW1lbnQ7CiAgICAgIH0KICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuQ09NTUVOVF9OT0RFKSB7CiAgICAgICAgY29uc3QgY29tbWVudCA9IG5vZGUgYXMgQ29tbWVudDsKICAgICAgICBpZiAoY29tbWVudC5kYXRhID09PSBgL3J3Omg6JHtpZH1gIHx8IGNvbW1lbnQuZGF0YSA9PT0gYC9oeWRyYXRpb24tYm91bmRhcnk6JHtpZH1gKSB7CiAgICAgICAgICBsZXQgcHJldjogQ2hpbGROb2RlIHwgbnVsbCA9IGNvbW1lbnQucHJldmlvdXNTaWJsaW5nOwogICAgICAgICAgd2hpbGUgKHByZXYgJiYgcHJldi5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgcHJldiA9IHByZXYucHJldmlvdXNTaWJsaW5nOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHByZXYgJiYgcHJldi5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgcmV0dXJuIHByZXYgYXMgRWxlbWVudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNvbW1lbnQuZGF0YSA9PT0gYGh5ZHJhdGlvbi1ib3VuZGFyeToke2lkfWApIHsKICAgICAgICAgIGxldCBuZXh0OiBDaGlsZE5vZGUgfCBudWxsID0gY29tbWVudC5uZXh0U2libGluZzsKICAgICAgICAgIHdoaWxlIChuZXh0ICYmIG5leHQubm9kZVR5cGUgIT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICAgICAgICAgIG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5leHQgJiYgbmV4dC5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgcmV0dXJuIG5leHQgYXMgRWxlbWVudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgbm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiBoeWRyYXRlU2NyaXB0KHNjcmlwdDogSFRNTFNjcmlwdEVsZW1lbnQpOiB2b2lkIHsKICAgIGNvbnN0IGlkID0gc2NyaXB0LmdldEF0dHJpYnV0ZSgiZGF0YS1oeWRyYXRlIikgPz8gIiI7CiAgICBpZiAoIWlkIHx8IGh5ZHJhdGVkLmhhcyhpZCkpIHJldHVybjsKCiAgICBjb25zdCBlbCA9IGZpbmRIeWRyYXRpb25FbGVtZW50KHNjcmlwdCk7CiAgICBpZiAoIWVsKSByZXR1cm47CgogICAgY29uc3QgcGF5bG9hZCA9IHBhcnNlUGF5bG9hZChzY3JpcHQudGV4dENvbnRlbnQgPz8gInt9Iik7CiAgICBoeWRyYXRlUGF5bG9hZChlbCwgcGF5bG9hZCk7CiAgICBoeWRyYXRlZC5hZGQoaWQpOwogIH0KCiAgZnVuY3Rpb24gdGVhcmRvd25FbGVtZW50KGVsOiBFbGVtZW50KTogdm9pZCB7CiAgICBjb25zdCBjdHggPSBjb250ZXh0cy5nZXQoZWwpOwogICAgaWYgKCFjdHgpIHJldHVybjsKCiAgICBjdHguY29udHJvbGxlcnMuZm9yRWFjaCgoY3RybCkgPT4gY3RybC5hYm9ydCgpKTsKICAgIGN0eC5jb250cm9sbGVycy5jbGVhcigpOwoKICAgIGlmIChjdHgudW5tb3VudC5sZW5ndGgpIHsKICAgICAgY3R4LnVubW91bnQuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgICAgICB2b2lkIGludm9rZUVudHJ5KGVsLCBlbnRyeSwgInVubW91bnQiLCBuZXcgRXZlbnQoInVubW91bnQiKSk7CiAgICAgIH0pOwogICAgICBjdHgudW5tb3VudC5sZW5ndGggPSAwOwogICAgfQoKICAgIGlmIChjdHgucmVmcy5sZW5ndGgpIHsKICAgICAgY3R4LnJlZnMuZm9yRWFjaCgocmVmKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChyZWYuZ2V0KCkgPT09IGVsKSB7CiAgICAgICAgICAgIHJlZi5zZXQobnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAvKiBpZ25vcmUgcmVmIGFzc2lnbm1lbnQgZXJyb3JzICovCiAgICAgICAgfQogICAgICB9KTsKICAgICAgY3R4LnJlZnMubGVuZ3RoID0gMDsKICAgIH0KCiAgICBjb250ZXh0cy5kZWxldGUoZWwpOwogIH0KCiAgY29uc3QgaXNIeWRyYXRpb25TY3JpcHQgPSAobm9kZTogTm9kZSk6IG5vZGUgaXMgSFRNTFNjcmlwdEVsZW1lbnQgPT4KICAgIG5vZGUgaW5zdGFuY2VvZiBIVE1MU2NyaXB0RWxlbWVudCAmJgogICAgKG5vZGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikgfHwgIiIpLnRvTG93ZXJDYXNlKCkgPT09ICJhcHBsaWNhdGlvbi9qc29uIiAmJgogICAgbm9kZS5oYXNBdHRyaWJ1dGUoImRhdGEtaHlkcmF0ZSIpOwoKICBmdW5jdGlvbiBzZWVkKCk6IHZvaWQgewogICAgZG9jdW1lbnQKICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdFt0eXBlPSJhcHBsaWNhdGlvbi9qc29uIl1bZGF0YS1oeWRyYXRlXScpCiAgICAgIC5mb3JFYWNoKChub2RlKSA9PiBoeWRyYXRlU2NyaXB0KG5vZGUgYXMgSFRNTFNjcmlwdEVsZW1lbnQpKTsKICB9CgogIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9ucykgPT4gewogICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHsKICAgICAgbXV0YXRpb24uYWRkZWROb2Rlcz8uZm9yRWFjaCgobm9kZSkgPT4gewogICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBFbGVtZW50KSkgcmV0dXJuOwogICAgICAgIGlmIChpc0h5ZHJhdGlvblNjcmlwdChub2RlKSkgewogICAgICAgICAgaHlkcmF0ZVNjcmlwdChub2RlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbm9kZQogICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdFt0eXBlPSJhcHBsaWNhdGlvbi9qc29uIl1bZGF0YS1oeWRyYXRlXScpCiAgICAgICAgICAuZm9yRWFjaCgoc2NyaXB0KSA9PiBoeWRyYXRlU2NyaXB0KHNjcmlwdCBhcyBIVE1MU2NyaXB0RWxlbWVudCkpOwogICAgICB9KTsKCiAgICAgIG11dGF0aW9uLnJlbW92ZWROb2Rlcz8uZm9yRWFjaCgobm9kZSkgPT4gewogICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBFbGVtZW50KSkgcmV0dXJuOwogICAgICAgIHRlYXJkb3duRWxlbWVudChub2RlKTsKICAgICAgICBub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKS5mb3JFYWNoKChjaGlsZCkgPT4gewogICAgICAgICAgdGVhcmRvd25FbGVtZW50KGNoaWxkKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIHNlZWQoKTsKICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTsKCiAgZ2xvYmFsV2luZG93Ll9fcnV3dXRlciA9IE9iamVjdC5hc3NpZ24oZ2xvYmFsV2luZG93Ll9fcnV3dXRlciA/PyB7fSwgewogICAgc3RvcmUsCiAgfSk7Cn0KCmlmIChoYXNXaW5kb3cpIHsKICBpbml0aWFsaXplQ2xpZW50UnVudGltZSgpOwp9CgpleHBvcnQge307Cg==";

let instance = 0;

export const nextClientRuntimeUrl = () =>
  `data:application/typescript;base64,${CLIENT_RUNTIME_BASE64}#${instance++}`;
